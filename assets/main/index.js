System.register("chunks:///_virtual/FieldController.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(i){"use strict";var e,t,n,r,o,l,s,a,h,u,c,f,d;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.inheritsLoose,n=i.defineProperty,r=i.assertThisInitialized,o=i.initializerDefineProperty},function(i){l=i.cclegacy,s=i._decorator,a=i.Prefab,h=i.instantiate,u=i.SystemEvent,c=i.Vec3,f=i.Animation,d=i.Component}],execute:function(){var m,b,p,g,T,P,y,x,v,S,k,I,C,w,B;l._RF.push({},"743e2r6rHdHHqAqbNF0bFiL","FieldController",void 0);var M=s.ccclass,N=s.property;i("FieldController",(m=M("FieldController"),b=N({type:a}),p=N({type:a}),g=N({type:a}),T=N({type:a}),P=N({type:a}),y=N({type:a}),m((S=e((v=function(i){function e(){for(var e,t=arguments.length,l=new Array(t),s=0;s<t;s++)l[s]=arguments[s];return e=i.call.apply(i,[this].concat(l))||this,n(r(e),"isPlaying",!1),n(r(e),"tileSize",50),n(r(e),"sideSpace",1),n(r(e),"fieldHeight",440),n(r(e),"fieldWidth",440),n(r(e),"columnsAmount",Math.floor(e.fieldWidth/e.tileSize)),n(r(e),"rowsAmount",Math.floor(e.fieldHeight/e.tileSize)),n(r(e),"firstColumnPositionByX",-1*(e.fieldWidth/2-e.fieldWidth%e.tileSize/2-e.tileSize/2+e.sideSpace*e.columnsAmount/2)),n(r(e),"matrix",[]),n(r(e),"minNumberOfTilesForBlast",2),n(r(e),"checkingIsPossibilityToBlast",!1),n(r(e),"minNumberOfBlastedTilesForSuperTile",5),n(r(e),"isSuperTile",null),o(r(e),"greenPrefab",S,r(e)),o(r(e),"bluePrefab",k,r(e)),o(r(e),"yellowPrefab",I,r(e)),o(r(e),"redPrefab",C,r(e)),o(r(e),"purplePrefab",w,r(e)),n(r(e),"tilePrefabs",[]),o(r(e),"superPrefab",B,r(e)),e}t(e,i);var l=e.prototype;return l.onLoad=function(){this.tilePrefabs=[this.greenPrefab,this.bluePrefab,this.yellowPrefab,this.purplePrefab,this.redPrefab]},l.setIsPlaying=function(i){i?(this.fillMatrix(),this.isPlaying=!0):this.isPlaying=!1},l.fillMatrix=function(){for(var i=0;i<this.columnsAmount;i++){for(var e=this.matrix[i]||[],t=e.length;t<this.rowsAmount;t++){var n=this.generateTileObj(i);e.push(n),this.setTilePosition(n,t),this.addTileNode(n)}this.matrix[i]||(this.matrix[i]=e)}this.isSuperTile&&this.generateSuperTile(),this.checkingIsPossibilityToBlast&&this.checkPossibilityToBlast()},l.clearMatrix=function(){for(var i=0;i<this.matrix.length;i++)for(var e=0;e<this.matrix[0].length;e++)this.matrix[i][e].node.destroy();this.matrix=[]},l.generateTileObj=function(i){var e=Math.floor(Math.random()*this.tilePrefabs.length);return{colIndex:i,isCheckedOutNeighboring:!1,node:h(this.tilePrefabs[e])}},l.addTileNode=function(i){var e=this;setTimeout((function(){e.node.addChild(i.node)}),100),i.node.on(u.EventType.MOUSE_UP,(function(t){0===t.getButton()&&e.onTileClick(i)}))},l.setTilePosition=function(i,e){i.node.setPosition(new c(this.firstColumnPositionByX+(this.tileSize+this.sideSpace)*i.colIndex+this.sideSpace,this.fieldHeight/2+this.tileSize*e))},l.onTileClick=function(i){if(this.isPlaying){var e=this.checkNeighbors(i);e.length>=this.minNumberOfBlastedTilesForSuperTile&&this.setSuperTile(i),e.length<this.minNumberOfTilesForBlast?this.resetCheckedTiles(e):this.blastTiles(e)}},l.checkNeighbors=function(i){var e=this,t=i.node.name,n=[];return function i(r,o){var l,s,a,h,u=e.matrix[r][o];u.isCheckedOutNeighboring||(n.push(u),u.isCheckedOutNeighboring=!0,(null===(l=e.matrix[r][o-1])||void 0===l?void 0:l.node.name)===t&&i(r,o-1),(null===(s=e.matrix[r][o+1])||void 0===s?void 0:s.node.name)===t&&i(r,o+1),(null===(a=e.matrix[r-1])||void 0===a?void 0:a[o].node.name)===t&&i(r-1,o),(null===(h=e.matrix[r+1])||void 0===h?void 0:h[o].node.name)===t&&i(r+1,o))}(i.colIndex,this.getTileRowIndex(i)),n},l.resetCheckedTiles=function(i){i.forEach((function(i){return i.isCheckedOutNeighboring=!1}))},l.getTileRowIndex=function(i){for(var e=this.matrix[i.colIndex],t=0;t<e.length;t++)if(e[t].node===i.node)return t},l.blastTiles=function(i){var e=this;i.forEach((function(i){var e;null===(e=i.node.getComponent(f))||void 0===e||e.play(),setTimeout((function(){i.node.destroy()}),200)})),this.matrix=this.matrix.map((function(i){return i.filter((function(i){return!i.isCheckedOutNeighboring}))})),setTimeout((function(){e.fillMatrix(),e.node.emit("TurnEnd",i.length)}),200)},l.setSuperTile=function(i){this.isSuperTile=i?{colIndex:i.colIndex,rowIndex:this.getTileRowIndex(i)}:null},l.generateSuperTile=function(){var i=this,e=this.isSuperTile,t=e.colIndex,n=e.rowIndex,r=this.matrix[t][n];r.node.name="super",r.node.addChild(h(this.superPrefab)),r.node.off(u.EventType.MOUSE_UP),r.node.on(u.EventType.MOUSE_UP,(function(){if(i.isPlaying){var e=i.matrix[r.colIndex];i.matrix[r.colIndex]=[],i.blastTiles(e)}})),this.setSuperTile(null)},l.shuffleMatrix=function(){if(this.isPlaying){for(var i=this.matrix.length-1;i>0;i--){for(var e=this.matrix[i],t=Math.floor(Math.random()*(i+1)),n=this.matrix[t],r=n.length-1;r>0;r--){var o=n[r],l=Math.floor(Math.random()*(r+1));n[r]=n[l],n[l]=o}this.matrix[i]=n,this.matrix[t]=e}for(var s=0;s<this.columnsAmount;s++)for(var a=0;a<this.rowsAmount;a++){var h=this.matrix[s][a];h.colIndex=s,this.setTilePosition(h,a)}this.checkingIsPossibilityToBlast&&this.checkPossibilityToBlast()}},l.setCheckingIsPossibilityToBlast=function(i){this.checkingIsPossibilityToBlast=i,i&&this.checkPossibilityToBlast()},l.checkPossibilityToBlast=function(){for(var i=!1,e=0;e<this.matrix.length&&!i;e++)for(var t=0;t<this.rowsAmount&&!i;t++){var n=this.checkNeighbors(this.matrix[e][t]);n.length>=this.minNumberOfTilesForBlast&&(i=!0),this.resetCheckedTiles(n)}i||this.node.emit("ThereIsNoPossibilityToBlast")},e}(d)).prototype,"greenPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(v.prototype,"bluePrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(v.prototype,"yellowPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(v.prototype,"redPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(v.prototype,"purplePrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(v.prototype,"superPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=v))||x));l._RF.pop()}}}));

System.register("chunks:///_virtual/Manager.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./FieldController.ts"],(function(e){"use strict";var t,n,i,r,s,o,l,u,a,f,h,c,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.defineProperty,r=e.assertThisInitialized,s=e.initializerDefineProperty},function(e){o=e.cclegacy,l=e._decorator,u=e.Label,a=e.Node,f=e.Sprite,h=e.Vec3,c=e.Component},function(e){b=e.FieldController}],execute:function(){var p,S,y,g,d,m,O,L,C,I,N,M,T,_,P,v,k,B,F;o._RF.push({},"f3c8dn822RKmLYQMBC+7f3V","Manager",void 0);var G,w=l.ccclass,D=l.property;!function(e){e[e.WIN=0]="WIN",e[e.LOS_ENDED_TURNS=1]="LOS_ENDED_TURNS",e[e.LOS_NO_POSSIBILITY=2]="LOS_NO_POSSIBILITY"}(G||(G={}));e("Manager",(p=w("Manager"),S=D({type:b}),y=D({type:u}),g=D({type:u}),d=D({type:a}),m=D({type:a}),O=D({type:u}),L=D({type:u}),C=D({type:f}),p((M=t((N=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return t=e.call.apply(e,[this].concat(o))||this,i(r(t),"turns",30),i(r(t),"score",0),i(r(t),"scoreForWin",100),i(r(t),"restOfTurns",t.turns),i(r(t),"numberOfShuffles",3),i(r(t),"restNumberOfShuffles",t.numberOfShuffles),s(r(t),"fieldController",M,r(t)),s(r(t),"turnsLabel",T,r(t)),s(r(t),"scoreLabel",_,r(t)),s(r(t),"startMenu",P,r(t)),s(r(t),"finishMenu",v,r(t)),s(r(t),"finishMenuLabel",k,r(t)),s(r(t),"shuffleButtonScore",B,r(t)),s(r(t),"progress",F,r(t)),t}n(t,e);var o=t.prototype;return o.start=function(){var e;this.onGameInit(),null===(e=this.fieldController)||void 0===e||e.node.on("TurnEnd",this.onTurnEnd,this)},o.onGameInit=function(){this.finishMenu.active=!1,this.startMenu.active=!0,this.score=0,this.restOfTurns=this.turns,this.restNumberOfShuffles=this.numberOfShuffles,this.updateCounter(),this.fieldController.setCheckingIsPossibilityToBlast(!1),this.fieldController.setIsPlaying(!1),this.fieldController.clearMatrix()},o.onGamePlay=function(){this.startMenu.active=!1,this.fieldController.setIsPlaying(!0)},o.onGameFinish=function(e){switch(this.fieldController.setIsPlaying(!1),this.finishMenu.active=!0,e){case G.WIN:this.finishMenuLabel.string="победа!!!";break;case G.LOS_ENDED_TURNS:this.finishMenuLabel.string="\n                    \n не получилось набрать \n                    \n "+this.scoreForWin+" очков за \n                    \n "+this.turns+" ходов\n                ";break;case G.LOS_NO_POSSIBILITY:this.finishMenuLabel.string="\n                    \n нет возможных ходов \n                    \n и лимит перемешиваний \n                    \n исчерпан \n                "}},o.onStartClick=function(){this.onGamePlay()},o.onRestartClick=function(){this.onGameInit(),this.onGamePlay()},o.onTurnEnd=function(e){this.restOfTurns--,this.score+=e,this.updateCounter(),this.checkCurrentGameProgress()},o.checkCurrentGameProgress=function(){this.score>=this.scoreForWin?this.onGameFinish(G.WIN):0===this.restOfTurns&&this.onGameFinish(G.LOS_ENDED_TURNS)},o.updateCounter=function(){this.turnsLabel.string=this.restOfTurns.toString(),this.scoreLabel.string=this.score.toString(),this.shuffleButtonScore.string=this.restNumberOfShuffles.toString(),this.progress.node.setScale(new h(this.score/this.scoreForWin,1))},o.onShuffleClick=function(){this.restNumberOfShuffles>0&&(this.fieldController.shuffleMatrix(),this.restNumberOfShuffles--,this.updateCounter()),0===this.restNumberOfShuffles&&this.checkPossibility()},o.checkPossibility=function(){var e=this;this.fieldController.node.on("ThereIsNoPossibilityToBlast",(function(){e.onGameFinish(G.LOS_NO_POSSIBILITY)})),this.fieldController.setCheckingIsPossibilityToBlast(!0)},t}(c)).prototype,"fieldController",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(N.prototype,"turnsLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(N.prototype,"scoreLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(N.prototype,"startMenu",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(N.prototype,"finishMenu",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(N.prototype,"finishMenuLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(N.prototype,"shuffleButtonScore",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(N.prototype,"progress",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=N))||I));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./FieldController.ts","./Manager.ts"],(function(){"use strict";return{setters:[null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});